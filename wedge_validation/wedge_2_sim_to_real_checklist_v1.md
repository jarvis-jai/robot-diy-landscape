# Sim-to-Real Checklist v1.0 — 模擬器到實機部署檢查清單

> 驗證狀態：初版草稿  
> 建立日期：2026-01-31  
> 目標使用者：在 Gazebo/Webots/Isaac Sim 完成專案，準備部署到實體機器人的 DIY 愛好者

---

## 📋 部署前檢查清單

### 1️⃣ 感測器校準與配置

- [ ] **LiDAR 配置確認**
  - [ ] 實際 LiDAR 的角度範圍與模擬一致？
  - [ ] 掃描頻率（Hz）與 ROS topic 發布頻率匹配？
  - [ ] 座標系（frame_id）正確設定？
  - [ ] 最小/最大探測距離與實際環境相符？

- [ ] **IMU 校準**
  - [ ] 在平面上執行初始校準（靜止 30 秒以上）
  - [ ] 磁力計已補償環境磁場干擾？
  - [ ] 融合濾波器（EKF/UKF）參數調整？
  - [ ] 確認 IMU 座標系與機器人 base_link 對齊

- [ ] **深度相機設定**
  - [ ] 曝光、白平衡設定適合實際光線環境？
  - [ ] 深度範圍（min/max）符合使用場景？
  - [ ] 已測試強光/背光/低光環境的表現？

- [ ] **編碼器校準**
  - [ ] 每轉脈衝數（PPR）與程式設定一致？
  - [ ] 輪徑測量精確（考慮輪胎變形）？
  - [ ] 輪距（track width）實際測量並更新？

### 2️⃣ 機械與物理差異

- [ ] **質量與慣性**
  - [ ] 實際機器人重量已測量？
  - [ ] 質心位置與模擬模型差異 <10%？
  - [ ] 載重變化時行為是否測試？

- [ ] **摩擦與滑動**
  - [ ] 不同地面材質測試（瓷磚、地毯、水泥）？
  - [ ] 輪胎打滑補償已調整？
  - [ ] 坡道行駛測試？

- [ ] **機械公差**
  - [ ] 關節/舵機有遊隙（backlash）？已補償？
  - [ ] 3D 列印零件精度檢查？
  - [ ] 連接器和線材固定牢靠？

### 3️⃣ 控制系統調整

- [ ] **PID 參數**
  - [ ] 模擬中的 PID 參數已記錄？
  - [ ] 實機 PID 需要重新調整（通常需要）
  - [ ] 有限位保護（防止失控）？

- [ ] **控制頻率**
  - [ ] 控制迴圈頻率在實機上達到目標？
  - [ ] CPU 負載在安全範圍內？
  - [ ] 優先級設定避免 deadline miss？

- [ ] **安全限制**
  - [ ] 速度上限設定？
  - [ ] 加速度限制防止滑動？
  - [ ] 緊急停止機制測試？

### 4️⃣ 通訊與延遲

- [ ] **網路配置**
  - [ ] ROS_DOMAIN_ID 設定正確？
  - [ ] 多機通訊時網路延遲測量？
  - [ ] Wi-Fi 訊號強度在工作區域穩定？

- [ ] **時間同步**
  - [ ] 使用 NTP/PTP 同步時間？
  - [ ] 感測器時間戳與系統時間一致？
  - [ ] TF 發布頻率足夠？

- [ ] **延遲測試**
  - [ ] 指令到動作的延遲測量？
  - [ ] 感測器數據到決策的延遲測量？
  - [ ] 端到端延遲是否在容許範圍內？

### 5️⃣ 電源管理

- [ ] **電池規格**
  - [ ] 電池容量足夠測試時長？
  - [ ] 低電壓保護設定？
  - [ ] 電池重量已計入機器人質量？

- [ ] **電源分配**
  - [ ] 所有元件電壓需求滿足？
  - [ ] 尖峰電流不超過電源供應能力？
  - [ ] 馬達啟動電流考慮？

- [ ] **散熱**
  - [ ] SBC（RPi/Jetson）散熱方案？
  - [ ] 馬達驅動散熱？
  - [ ] 長時間運行溫度監控？

### 6️⃣ 座標系與 TF

- [ ] **URDF/Xacro 更新**
  - [ ] 實際尺寸與 URDF 模型一致？
  - [ ] 感測器位置偏移已校正？
  - [ ] 關節限位與實際一致？

- [ ] **TF 樹完整**
  - [ ] 所有 frame 正確發布？
  - [ ] 無懸空 frame？
  - [ ] 時間戳正確（無 extrapolation 警告）？

### 7️⃣ 軟體版本與相依

- [ ] **ROS 版本**
  - [ ] 開發機與實機 ROS 版本一致？
  - [ ] 相依套件版本記錄？

- [ ] **驅動程式**
  - [ ] 感測器驅動已安裝並測試？
  - [ ] 馬達驅動器韌體版本？

- [ ] **自定義程式碼**
  - [ ] 所有參數可在 launch 檔調整？
  - [ ] 硬編碼的模擬器特定數值已移除？

---

## 🔧 常見陷阱與解法

### 陷阱 1：LiDAR 在模擬中完美，實機撞牆

**症狀**：障礙物偵測失敗，機器人撞到低矮或透明物體

**原因**：
- 模擬 LiDAR 假設理想反射
- 實際環境有透明玻璃、黑色吸光材料、過低物體

**解法**：
1. 測試 LiDAR 對各種材質的反射率
2. 添加保守安全距離（+20-30%）
3. 考慮多感測器融合（LiDAR + 超音波）

### 陷阱 2：ROS 2 控制頻率在實機驟降

**症狀**：模擬中 100Hz 的控制迴圈，實機只有 30Hz

**原因**：
- SBC（RPi/Jetson）CPU 負載過高
- 感測器處理佔用過多資源
- 未設定即時調度優先級

**解法**：
1. 使用 `htop` 或 `ros2 topic hz` 監控
2. 優化感測器回調（避免在回調中做重計算）
3. 考慮分離高頻控制到 microcontroller（micro-ROS）
4. 設定 `nice` 或 real-time priority

### 陷阱 3：完美的 SLAM 地圖在實機漂移

**症狀**：建圖時定位準確，稍後重新定位後漂移

**原因**：
- IMU 未校準，累積誤差
- 輪子打滑導致里程計錯誤
- 環境變化（光線、移動物體）

**解法**：
1. 確認 IMU 已正確校準
2. 使用感測器融合（LiDAR + IMU + 編碼器）
3. 添加迴環偵測
4. 在相同環境條件下測試

### 陷阱 4：電源不足導致怪異行為

**症狀**：運行一段時間後，馬達力矩下降、感測器讀數異常

**原因**：
- 電池電壓下降
- 馬達啟動瞬間電流過大
- 共地問題

**解法**：
1. 監控電池電壓（軟體或硬體）
2. 馬達和邏輯電路分開供電
3. 添加電容平滑電流尖峰
4. 設定低電壓警告閾值

### 陷阱 5：座標系錯誤導致奇怪運動

**症狀**：指令向前，機器人向後或側移

**原因**：
- URDF 中感測器/馬達座標系錯誤
- TF 發布的 frame 名稱不一致
- 左右手座標系混淆

**解法**：
1. 用 RViz 檢視 TF 樹和座標軸方向
2. 單獨測試每個感測器的座標正確性
3. 用 `ros2 run tf2_ros tf2_echo` 檢查 transform

---

## 📊 Sim-to-Real Gap 程度自評表

完成以上檢查後，評估你的 sim-to-real gap：

| 類別 | 模擬與實機差異程度 | 風險等級 |
|------|-------------------|---------|
| 感測器配置 | ☐ 一致 ☐ 小差異 ☐ 大差異 | 🟢 🟡 🔴 |
| 機械參數 | ☐ 一致 ☐ 小差異 ☐ 大差異 | 🟢 🟡 🔴 |
| 控制系統 | ☐ 一致 ☐ 小差異 ☐ 大差異 | 🟢 🟡 🔴 |
| 通訊延遲 | ☐ <10ms ☐ 10-50ms ☐ >50ms | 🟢 🟡 🔴 |
| 電源穩定性 | ☐ 穩定 ☐ 偶爾問題 ☐ 不穩定 | 🟢 🟡 🔴 |
| TF/座標系 | ☐ 驗證過 ☐ 部分驗證 ☐ 未驗證 | 🟢 🟡 🔴 |

**解讀**：
- 全 🟢：可以進行完整功能測試
- 有 🟡：需要逐步測試，先低速運行
- 有 🔴：停！先解決紅色項目再繼續

---

## 📚 延伸資源

### 工具
- **Isaac Lab**：專為 sim-to-real 設計的 GPU 加速學習環境
- **LeRobot**：端到端的 robot learning 框架，支援 sim-to-real
- **Newton Physics**：Linux Foundation 開源物理引擎

### 教程
- Articulated Robotics：ROS 2 實機整合系列
- Automatic Addison：感測器整合教程
- Nav2 文檔：導航堆棧部署指南

### 社群
- Open Robotics Discord
- r/ROS
- ROS Discourse

---

## 🔄 更新紀錄

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| v1.0 | 2026-01-31 | 初版 - 6 大類 30+ 檢查項目 |

---

*此 checklist 基於 robot-diy-landscape repo 的 gap 分析（Gap #9）建立。*
*歡迎 PR 補充你的 sim-to-real 經驗！*
